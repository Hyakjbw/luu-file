<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme Hub VIP</title>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #FF3CAC;
            --secondary: #784BA0;
            --bg-color: #0f172a;
            --glass: rgba(255, 255, 255, 0.1);
            --border: rgba(255, 255, 255, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Be Vietnam Pro', sans-serif; }

        body {
            background-image: linear-gradient(225deg, #FF3CAC 0%, #784BA0 50%, #2B86C5 100%);
            min-height: 100vh;
            color: white;
            padding-bottom: 50px;
        }

        /* --- MENU TAB --- */
        .nav-container {
            position: fixed;
            top: 0; left: 0; width: 100%;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(15px);
            z-index: 100;
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 20px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .tab-btn {
            background: transparent;
            border: none;
            color: #ccc;
            font-size: 16px;
            font-weight: 600;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 30px;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn.active {
            background: white;
            color: var(--secondary);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .content-section {
            display: none;
            padding-top: 100px; /* Tránh menu che mất */
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            animation: fadeIn 0.5s;
        }

        .content-section.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* --- PHẦN 1: RANDOM SINGLE --- */
        .single-card {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            max-width: 500px;
            margin: 0 auto;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .img-frame {
            min-height: 300px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }

        .img-frame img {
            max-width: 100%;
            border-radius: 10px;
            display: none; /* Ẩn chờ load */
        }

        /* --- PHẦN 2: LIST GALLERY --- */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .gallery-item {
            position: relative;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            overflow: hidden;
            aspect-ratio: 1/1;
            transition: 0.3s;
            border: 1px solid transparent;
        }

        .gallery-item:hover {
            transform: scale(1.03);
            border-color: white;
            z-index: 10;
        }

        .gallery-item img {
            width: 100%; height: 100%; object-fit: cover;
            cursor: pointer;
        }

        /* --- BUTTONS --- */
        .btn-action {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: white;
            text-decoration: none; /* Cho thẻ a */
        }

        .btn-pink { background: linear-gradient(45deg, #FF3CAC, #784BA0); box-shadow: 0 4px 15px rgba(255, 60, 172, 0.4); }
        .btn-blue { background: linear-gradient(45deg, #00C6FF, #0072FF); box-shadow: 0 4px 15px rgba(0, 114, 255, 0.4); }
        .btn-green { background: linear-gradient(45deg, #11998e, #38ef7d); color: #fff; }

        .btn-action:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-action:active { transform: scale(0.95); }

        /* --- LOADER --- */
        .loader {
            width: 40px; height: 40px;
            border: 4px solid #fff;
            border-bottom-color: transparent;
            border-radius: 50%;
            animation: spin 1s infinite linear;
            margin: 20px auto;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Nút download overlay cho Gallery */
        .dl-overlay {
            position: absolute;
            bottom: 10px; right: 10px;
            background: white;
            color: black;
            width: 35px; height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: 0.3s;
            cursor: pointer;
        }
        .gallery-item:hover .dl-overlay { opacity: 1; }

    </style>
</head>
<body>

    <div class="nav-container">
        <button class="tab-btn active" onclick="switchTab('single')">
            <i class="fa-solid fa-dice"></i> Random 1 Ảnh
        </button>
        <button class="tab-btn" onclick="switchTab('list')">
            <i class="fa-solid fa-images"></i> Danh Sách Ảnh
        </button>
    </div>

    <div id="single-tab" class="content-section active">
        <div class="single-card">
            <h2>Meme Hôm Nay</h2>
            <div class="img-frame">
                <div class="loader" id="single-loader"></div>
                <img id="single-img" onload="imgLoaded('single')" onerror="imgError('single')" src="">
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn-action btn-blue" onclick="loadSingleMeme()">
                    <i class="fa-solid fa-sync"></i> Ảnh Khác
                </button>
                <a id="download-btn-single" class="btn-action btn-pink" href="#" target="_blank" download="meme.jpg">
                    <i class="fa-solid fa-download"></i> Tải Về
                </a>
            </div>
        </div>
    </div>

    <div id="list-tab" class="content-section">
        <div style="text-align: center; margin-bottom: 20px;">
            <button class="btn-action btn-green" onclick="addMoreMemes(20)">
                <i class="fa-solid fa-plus-circle"></i> Tải thêm 20 ảnh
            </button>
            <button class="btn-action btn-pink" onclick="resetGallery()">
                <i class="fa-solid fa-trash-alt"></i> Xóa hết
            </button>
        </div>
        
        <div class="gallery-grid" id="gallery-grid">
            </div>
    </div>

    <script>
        const API_BASE = "https://api.phimtat.vn/api/random-meme/";

        // --- 1. HÀM CHUYỂN TAB ---
        function switchTab(tab) {
            // Ẩn hết
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            // Hiện cái cần hiện
            if (tab === 'single') {
                document.getElementById('single-tab').classList.add('active');
                document.querySelector('button[onclick="switchTab(\'single\')"]').classList.add('active');
            } else {
                document.getElementById('list-tab').classList.add('active');
                document.querySelector('button[onclick="switchTab(\'list\')"]').classList.add('active');
                // Nếu list trống thì tự load lần đầu
                if(document.getElementById('gallery-grid').children.length === 0) {
                    addMoreMemes(20);
                }
            }
        }

        // --- 2. XỬ LÝ TAB SINGLE (1 ẢNH) ---
        function loadSingleMeme() {
            const img = document.getElementById('single-img');
            const loader = document.getElementById('single-loader');
            const dlBtn = document.getElementById('download-btn-single');

            img.style.display = 'none';
            loader.style.display = 'block';

            // KỸ THUẬT QUAN TRỌNG:
            // Thêm ?t=thời_gian để trình duyệt hiểu là ảnh mới, không dùng cache cũ
            const uniqueUrl = API_BASE + "?t=" + new Date().getTime();
            
            img.src = uniqueUrl;
            
            // Update nút download (Mở ảnh trong tab mới để tải vì lý do bảo mật CORS)
            dlBtn.href = uniqueUrl; 
        }

        function imgLoaded(type) {
            if(type === 'single') {
                document.getElementById('single-loader').style.display = 'none';
                document.getElementById('single-img').style.display = 'block';
            }
        }

        function imgError(type) {
            if(type === 'single') {
                alert("Lỗi tải ảnh. Server phimtat.vn có thể đang bận.");
                loadSingleMeme(); // Thử lại
            }
        }

        // --- 3. XỬ LÝ TAB LIST (NHIỀU ẢNH) ---
        function addMoreMemes(count) {
            const grid = document.getElementById('gallery-grid');
            
            for(let i = 0; i < count; i++) {
                // Tạo ID ngẫu nhiên cho mỗi ảnh để không bị trùng
                const randomID = Math.floor(Math.random() * 10000000);
                const uniqueUrl = `${API_BASE}?id=${randomID}`;

                const div = document.createElement('div');
                div.className = 'gallery-item';
                div.innerHTML = `
                    <img src="${uniqueUrl}" loading="lazy" alt="Meme">
                    <a href="${uniqueUrl}" target="_blank" class="dl-overlay" title="Tải ảnh này">
                        <i class="fa-solid fa-download"></i>
                    </a>
                `;
                grid.appendChild(div);
            }
        }

        function resetGallery() {
            document.getElementById('gallery-grid').innerHTML = '';
            addMoreMemes(20); // Reset xong load lại 20 cái mới
        }

        // Khởi chạy lần đầu
        loadSingleMeme();

    </script>
</body>
</html>
