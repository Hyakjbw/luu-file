<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload to Google Drive</title>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; background: #f0f2f5; }
        .box {
            background: white; max-width: 400px; margin: 0 auto;
            padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        h2 { color: #4285F4; margin-top: 0; }
        input { margin-bottom: 20px; }
        button {
            background: #4285F4; color: white; border: none;
            padding: 12px 25px; border-radius: 6px; cursor: pointer; font-size: 16px; width: 100%;
        }
        button:hover { background: #3367d6; }
        button:disabled { background: #ccc; }
        #status { margin-top: 15px; font-size: 14px; word-wrap: break-word; }
        a { color: #4285F4; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>

    <div class="box">
        <h2>Upload Google Drive</h2>
        <input type="file" id="fileInput">
        <button id="btnUpload" onclick="uploadFile()">Tải lên Drive</button>
        <div id="status"></div>
    </div>

    <script>
        // --- CẤU HÌNH ---
        // Dán cái link Web App URL bạn copy từ bước 1 vào đây
        const SCRIPT_URL = "https://script.google.com/macros/s/xxxxxxxxxxxxxxxxxxxxxxxxx/exec";
        // ----------------

        function uploadFile() {
            var fileInput = document.getElementById('fileInput');
            var status = document.getElementById('status');
            var btn = document.getElementById('btnUpload');

            if (fileInput.files.length === 0) {
                alert("Chọn file đi bạn ơi!");
                return;
            }

            var file = fileInput.files[0];
            
            // Google Apps Script giới hạn upload khoảng 50MB, nhưng để an toàn thì < 20MB thôi
            if (file.size > 20 * 1024 * 1024) {
                alert("File quá lớn! Google Script chỉ chịu được file < 20MB thôi.");
                return;
            }

            btn.disabled = true;
            btn.innerText = "Đang tải lên (Đợi tí)...";
            status.innerText = "";

            var reader = new FileReader();
            reader.readAsDataURL(file);
            
            reader.onload = function(e) {
                var rawLog = reader.result.split(',')[1]; // Lấy nội dung base64
                
                var dataObj = {
                    base64: rawLog,
                    mimeType: file.type,
                    filename: file.name
                };

                fetch(SCRIPT_URL, {
                    method: "POST",
                    body: JSON.stringify(dataObj)
                })
                .then(response => response.json())
                .then(data => {
                    if(data.status === 'success'){
                        status.innerHTML = `<p style="color:green">✅ Đã lưu vào Drive!</p>
                                            <p><a href="${data.viewLink}" target="_blank">Xem file tại đây</a></p>`;
                    } else {
                        status.innerHTML = `<p style="color:red">Lỗi: ${data.message}</p>`;
                    }
                })
                .catch(error => {
                    status.innerHTML = `<p style="color:red">Lỗi mạng hoặc CORS (Nhưng có thể file đã vào Drive rồi, hãy kiểm tra).</p>`;
                    console.error(error);
                })
                .finally(() => {
                    btn.disabled = false;
                    btn.innerText = "Tải lên Drive";
                });
            };
        }
    </script>
</body>
</html>
